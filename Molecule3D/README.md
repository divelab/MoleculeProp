# Molecule3D: A Benchmark for Predicting 3D Geometries from Molecular Graphs
In this module, we provide software tools for processing our proposed Molecule3D dataset and codes to reproduce the baseline results. The goal of this module is to provide a benchmark for ground-state geometry prediction. Our paper is available [here](https://openreview.net/forum?id=m5rEiGxOGiL).

## Download Dataset
Please download the raw data from [here](https://drive.google.com/drive/u/2/folders/1y-EyoDYMvWZwClc2uvXrM4_hQBtM85BI?usp=sharing). Then, put it in your data folder.

```
|-- Molecule3D
    |-- build_yours.ipynb
    |-- data
        |-- raw
        |-- processed
    |-- results
```

## Environment setup
The following dependencies are required to be installed:

- scipy
- IPython
- tqdm
- rdkit-pypi
- pandas
- [Pytorch](https://pytorch.org/get-started/locally/)
- [Pytorch Geometric >= 1.7.0](https://pytorch-geometric.readthedocs.io/en/latest/notes/installation.html)

Then you can install the moleculex package by the following command:

```
pip install moleculex==0.0.3
```

## Running Baseline Methods

Download the code and go to the Molecule3D directory:

```
git clone https://github.com/divelab/MoleculeX
cd Molecule3D
```

## Develop your own models

Create your workspace following the directory tree shown in Download Dataset.
Follow build_yours.ipynb as an example to develop your own models. 

### Geometry Prediction
You can run pred3d_dist.py to train a model for ground-state geometry prediction. Before running, please specify the path to save the checkpoints and other outputs in conf['out_path'], and whether using random or scaffold split in conf['split']. Then, execute the following command:

```
CUDA_VISIBLE_DEVICES=${your_gpu_id} python pred3d_dist.py
```

### Property Prediction
You can run pred_prop_3d.py to train a model for property prediction with geometries. Before running, please specify the path to save the checkpoints and other outputs in conf['out_path'], and whether using random or scaffold split in conf['split']. In addition, you need to specify the type of geometry to be used in conf['geoinput']. Use 'pred' for the predicted geometry, 'gt' for the ground-truth geometry, and 'rdkit' for the geometry generated by RDKit. If you are using the predicted geometry, you also need to specify the path to the saved geometry prediction checkpoints in conf['geo_model_path']. Besides, you can specify the property to be predicted by setting the target id number in conf['target'] according to the following table.

| Target ID Number | Property |
| ---------------- | -------- |
| 0 | Dipole x |
| 1 | Dipole y |
| 2 | Dipole z |
| 3 | HOMO |
| 4 | LUMO |
| 5 | HOMO-LUMO Gap |
| 6 | SCF Energy |

Then, execute the following command:

```
CUDA_VISIBLE_DEVICES=${your_gpu_id} python pred_prop_3d.py
```

You can run pred_prop_2d.py to train a model for property prediction with only molecular graphs. Before running, please specify the path to save the checkpoints and other outputs in conf['out_path'], and whether using random or scaffold split in conf['split']. Similarly, specify the target id number according to the above table. Then, execute the following command:

```
CUDA_VISIBLE_DEVICES=${your_gpu_id} python pred_prop_2d.py
```